# https://www.robustperception.io/reduce-noise-from-disk-space-alerts/
groups:
- name: loki-disk-monitoring
  rules:
  - alert: LokiDiskWillFillIn2Hours
    expr: predict_linear(node_filesystem_free_bytes{mountpoint="/loki/chunks"}[30m], 2 * 3600) < 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: "Loki disk is filling instance {{ $labels.instance }}"
      description: "The {{ $labels.job }} alerts the disk is going to be filled in 2hs."
  - alert: LokiDiskWillFillIn4Hours
    expr: predict_linear(node_filesystem_free_bytes{mountpoint="/loki/chunks"}[1h], 4 * 3600) < 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: Loki disk is filling (instance {{ $labels.instance }})
      description: "The {{ $labels.job }} alerts the disk is going to be filled in 4hs."
  - alert: LokiDiskWillFillIn8Hours
    expr: predict_linear(node_filesystem_free_bytes{mountpoint="/loki/chunks"}[2h], 8 * 3600) < 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: Loki disk is filling (instance {{ $labels.instance }})
      description: "The {{ $labels.job }} alerts the disk is going to be filled in 8hs."
  - alert: LokiDiskWillFillIn12Hours
    expr: predict_linear(node_filesystem_free_bytes{mountpoint="/loki/chunks"}[3h], 12 * 3600) < 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: Loki disk is filling (instance {{ $labels.instance }})
      description: "The {{ $labels.job }} alerts the disk is going to be filled in 12hs."
  - alert: LokiDiskWillFillIn24Hours
    expr: predict_linear(node_filesystem_free_bytes{mountpoint="/loki/chunks"}[6h], 24 * 3600) < 0
    for: 5m
    labels:
      severity: critical
    annotations:
      summary: Loki disk is filling (instance {{ $labels.instance }})
      description: "The {{ $labels.job }} alerts the disk is going to be filled in 24hs."
